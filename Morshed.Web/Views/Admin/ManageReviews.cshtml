@using Morshed.Core.Entities
@model IEnumerable<Review>

@{
    Layout = "~/Views/Shared/_AdminLayout.cshtml"; 
    ViewData["Title"] = "Manage Reviews";
}

<!-- ربط ملف الستايل الموحد للأدمن -->
<link rel="stylesheet" href="~/css/admin_create.css?v=4.0">
<link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400..700&family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">


<div class="container">

    <!-- Header -->
    <div class="admin-header">
        <h2>User Reviews</h2>
        <p>Monitor feedback and maintain community standards</p>
    </div>

    <!-- Action Bar (Count Display) -->
    <div class="page-action-header">
        <h4 style="font-family:'Playfair Display'; color:var(--primary-dark); margin:0;">
            Total Reviews (@(Model?.Count() ?? 0))
        </h4>
    </div>

    <!-- The Table Card -->
    <div class="admin-table-container">
        <table class="table">
            <thead>
                <tr>
                    <th style="width: 20%;">User</th>
                    <th style="width: 20%;">Place</th>
                    <th style="width: 15%;">Rating</th>
                    <th style="width: 30%;">Comment</th>
                    <th style="width: 15%; text-align: center;">Date</th>
                    <th class="text-center" style="width: 10%;">Actions</th>
                </tr>
            </thead>
            <tbody>
                @if (Model != null && Model.Any())
                {
                    foreach (var item in Model)
                    {
                        <tr>
                            <!-- اسم المستخدم مع أيقونة -->
                            <td>
                                <div style="display:flex; align-items:center;">
                                    <div class="user-avatar-circle">
                                        @(item.User?.UserName?.Substring(0, 1).ToUpper() ?? "U")
                                    </div>
                                    <span style="font-weight: 600; color: var(--primary-dark);">@item.User?.UserName</span>
                                </div>
                            </td>

                            <!-- اسم المكان -->
                            <td style="color: #555;">
                                <i class="fas fa-map-marker-alt text-muted me-1"></i> @item.Place?.Name
                            </td>

                            <!-- التقييم (نجوم) -->
                            <td>
                                <div class="rating-badge">
                                    @item.Rating <i class="fas fa-star"></i>
                                </div>
                            </td>

                            <!-- التعليق (مختصر) -->
                            <td>
                                <span class="text-muted" style="font-style:italic;">
                                    "@(item.Comment?.Length > 50 ? item.Comment.Substring(0, 50) + "..." : item.Comment)"
                                </span>
                            </td>

                            <!-- التاريخ -->
                            <td class="text-center" style="font-size: 0.85rem; color: #888;">
                                @item.CreatedAt.ToString("MMM dd, yyyy")
                            </td>

                            <!-- زرار الحذف -->
                            <td class="text-center">
                                <form asp-action="DeleteReview" asp-route-id="@item.Id" method="post" style="display:inline;" onsubmit="return confirm('Are you sure you want to delete this review?');">
                                    <button type="submit" class="btn-action-sm btn-delete" title="Delete Review">
                                        <i class="fas fa-trash-alt"></i> Delete
                                    </button>
                                </form>
                            </td>
                        </tr>
                    }
                }
                else
                {
                    <tr>
                        <td colspan="6" class="text-center py-5">
                            <div style="opacity: 0.5;">
                                <i class="fas fa-comment-slash fa-3x mb-3 text-muted"></i>
                                <h5 class="text-muted">No reviews found yet.</h5>
                            </div>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>

</div>