@model Morshed.Core.Entities.Place

@{
    ViewData["Title"] = Model.Name;
}

<div class="row">
    <div class="col-md-8">
        <div id="placeCarousel" class="carousel slide mb-4 border-pharaonic" data-bs-ride="carousel">
            <div class="carousel-inner">
                @if (Model.Images != null && Model.Images.Any())
                {
                    var first = true;
                    foreach (var img in Model.Images)
                    {
                        <div class="carousel-item @(first ? "active" : "")">
                            <img src="@img.Url" class="d-block w-100" alt="@Model.Name" style="height: 400px; object-fit: cover;">
                        </div>
                        first = false;
                    }
                }
                else
                {
                    <div class="carousel-item active">
                        <img src="https://via.placeholder.com/800x400?text=No+Image" class="d-block w-100" alt="No Image">
                    </div>
                }
            </div>
            <button class="carousel-control-prev" type="button" data-bs-target="#placeCarousel" data-bs-slide="prev">
                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                <span class="visually-hidden">Previous</span>
            </button>
            <button class="carousel-control-next" type="button" data-bs-target="#placeCarousel" data-bs-slide="next">
                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                <span class="visually-hidden">Next</span>
            </button>
        </div>

        <h1 class="mb-3">@Model.Name</h1>
        <div class="mb-3">
            <span class="badge bg-gold text-dark me-2">@Model.Category</span>
             </div>
        <p class="lead">@Model.Description</p>
        <p><i class="fas fa-map-marker-alt text-danger"></i> @Model.Address</p>

        <hr />

        <h3>Reviews</h3>
        @if (Model.Reviews != null && Model.Reviews.Any())
        {
            foreach (var review in Model.Reviews)
            {
                <div class="card mb-3">
                    <div class="card-body">
                        <h5 class="card-title">@review.User?.UserName <span class="text-warning float-end">@review.Rating <i class="fas fa-star"></i></span></h5>
                        <p class="card-text">@review.Comment</p>
                        <p class="card-text"><small class="text-muted">@review.CreatedAt.ToShortDateString()</small></p>
                    </div>
                </div>
            }
        }
        else
        {
            <p class="text-muted">No reviews yet.</p>
        }

        @if (User.Identity.IsAuthenticated)
        {
            <div class="card bg-light mt-4">
                <div class="card-body">
                    <h4>Write a Review</h4>
                    <form asp-action="AddReview" method="post">
                        <input type="hidden" name="placeId" value="@Model.Id" />
                        <div class="mb-3">
                            <label class="form-label">Rating</label>
                            <select name="rating" class="form-select">
                                <option value="5">5 - Excellent</option>
                                <option value="4">4 - Very Good</option>
                                <option value="3">3 - Good</option>
                                <option value="2">2 - Fair</option>
                                <option value="1">1 - Poor</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Comment</label>
                            <textarea name="comment" class="form-control" rows="3" required></textarea>
                        </div>
                        <button type="submit" class="btn btn-primary">Submit Review</button>
                    </form>
                </div>
            </div>
        }
        else
        {
            <div class="alert alert-info mt-4">
                <a asp-area="Identity" asp-page="/Account/Login">Login</a> to write a review.
            </div>
        }
    </div>

    <div class="col-md-4">
        <div class="card mb-4 border-pharaonic">
            <div class="card-body">
                <h4 class="card-title">Actions</h4>
                @if (User.Identity.IsAuthenticated)
                {
                    <form asp-action="Bookmark" method="post">
                        <input type="hidden" name="placeId" value="@Model.Id" />
                        <button type="submit" class="btn btn-gold w-100 mb-2"><i class="far fa-bookmark"></i> Bookmark</button>
                    </form>
                    <button class="btn btn-outline-primary w-100"><i class="fas fa-plus"></i> Add to Tour</button>
                }
                else
                {
                    <p>Login to bookmark or add to tour.</p>
                }
            </div>
        </div>

        <div class="card border-pharaonic">
            <div class="card-body">
                <h4 class="card-title">Location</h4>
                <!-- Static Map Placeholder Small -->
                <div style="height: 200px; background-color: #e9ecef; display: flex; align-items: center; justify-content: center;">
                    <span class="text-muted">Map Preview</span>
                </div>
            </div>
        </div>
    </div>
</div>
